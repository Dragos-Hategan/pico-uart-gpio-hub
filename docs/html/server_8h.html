<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.14.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Pico UART GPIO Hub: include/server.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Pico UART GPIO Hub
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.14.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('server_8h.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">server.h File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Central interface for server-side UART client management and GPIO state handling.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;stdio.h&gt;</code><br />
<code>#include &quot;hardware/uart.h&quot;</code><br />
<code>#include &quot;pico/multicore.h&quot;</code><br />
<code>#include &quot;<a class="el" href="menu_8h_source.html">menu.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="types_8h_source.html">types.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="config_8h_source.html">config.h</a>&quot;</code><br />
</div>
<p><a href="server_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-define-members" class="groupheader"><a id="define-members" name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:ae0cb76c73e0b10cd0a339a3d50189a6c" id="r_ae0cb76c73e0b10cd0a339a3d50189a6c"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ae0cb76c73e0b10cd0a339a3d50189a6c">UART_SPINLOCK_ID</a>&#160;&#160;&#160;0</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-func-members" class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ab855eab340123db70c04fa5c11b7a030" id="r_ab855eab340123db70c04fa5c11b7a030"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ab855eab340123db70c04fa5c11b7a030">send_uart_message_safe</a> (uart_inst_t *uart, <a class="el" href="structuart__pin__pair__t.html">uart_pin_pair_t</a> pins, const char *msg)</td></tr>
<tr class="memdesc:ab855eab340123db70c04fa5c11b7a030"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sends a UART message safely using spinlock protection.  <br /></td></tr>
<tr class="memitem:ad2a8b81914e338148d4ca14af0dda019" id="r_ad2a8b81914e338148d4ca14af0dda019"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ad2a8b81914e338148d4ca14af0dda019">send_wakeup_if_dormant</a> (uint32_t flash_client_index, <a class="el" href="structserver__persistent__state__t.html">server_persistent_state_t</a> *const state, <a class="el" href="structuart__pin__pair__t.html">uart_pin_pair_t</a> pin_pair, uart_inst_t *const uart)</td></tr>
<tr class="memdesc:ad2a8b81914e338148d4ca14af0dda019"><td class="mdescLeft">&#160;</td><td class="mdescRight">Wakes up a dormant client if needed, based on its persistent state.  <br /></td></tr>
<tr class="memitem:abf6b2d1e49b4c895c9672070cb2d1c98" id="r_abf6b2d1e49b4c895c9672070cb2d1c98"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#abf6b2d1e49b4c895c9672070cb2d1c98">send_dormant_flag_to_client</a> (uint8_t client_index)</td></tr>
<tr class="memdesc:abf6b2d1e49b4c895c9672070cb2d1c98"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sends a dormant flag message to a specific client over UART.  <br /></td></tr>
<tr class="memitem:a5373fcd0050ee1a3cccb2d3f7096b489" id="r_a5373fcd0050ee1a3cccb2d3f7096b489"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a5373fcd0050ee1a3cccb2d3f7096b489">signal_reset_for_all_clients</a> ()</td></tr>
<tr class="memdesc:a5373fcd0050ee1a3cccb2d3f7096b489"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sends a reset trigger message to all clients.  <br /></td></tr>
<tr class="memitem:a32876b443b0945b7f0a82cd1cb8dae68" id="r_a32876b443b0945b7f0a82cd1cb8dae68"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a32876b443b0945b7f0a82cd1cb8dae68">send_fast_blink_onboard_led_to_clients</a> ()</td></tr>
<tr class="memdesc:a32876b443b0945b7f0a82cd1cb8dae68"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sends a fast onboard LED blink signal to all clients.  <br /></td></tr>
<tr class="memitem:ac3717ffc0c3e393f14d1114bb67a0a5e" id="r_ac3717ffc0c3e393f14d1114bb67a0a5e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ac3717ffc0c3e393f14d1114bb67a0a5e">send_dormant_to_standby_clients</a> (void)</td></tr>
<tr class="memdesc:ac3717ffc0c3e393f14d1114bb67a0a5e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sends a dormant message to all clients marked as dormant.  <br /></td></tr>
<tr class="memitem:a85446e6a4007b664f2fb03cfa588e092" id="r_a85446e6a4007b664f2fb03cfa588e092"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a85446e6a4007b664f2fb03cfa588e092">server_send_client_state</a> (<a class="el" href="structuart__pin__pair__t.html">uart_pin_pair_t</a> pin_pair, uart_inst_t *uart, const <a class="el" href="structclient__state__t.html">client_state_t</a> *state)</td></tr>
<tr class="memdesc:a85446e6a4007b664f2fb03cfa588e092"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sends the entire current client state over UART.  <br /></td></tr>
<tr class="memitem:a5dc7da044bb632212f8b68cfaf3f598c" id="r_a5dc7da044bb632212f8b68cfaf3f598c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a5dc7da044bb632212f8b68cfaf3f598c">periodic_wakeup</a> (void)</td></tr>
<tr class="memdesc:a5dc7da044bb632212f8b68cfaf3f598c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Core1 wakeup handler triggered by inter-core messages.  <br /></td></tr>
<tr class="memitem:abef816bc7a87ae61e1da71a2d0c5da91" id="r_abef816bc7a87ae61e1da71a2d0c5da91"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#abef816bc7a87ae61e1da71a2d0c5da91">server_find_connections</a> (void)</td></tr>
<tr class="memdesc:abef816bc7a87ae61e1da71a2d0c5da91"><td class="mdescLeft">&#160;</td><td class="mdescRight">Scans all possible UART pin pairs to detect connected clients.  <br /></td></tr>
<tr class="memitem:a050f4f15325b256ffb95a79c912dcb09" id="r_a050f4f15325b256ffb95a79c912dcb09"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a050f4f15325b256ffb95a79c912dcb09">server_set_device_state_and_update_flash</a> (<a class="el" href="structuart__pin__pair__t.html">uart_pin_pair_t</a> pin_pair, uart_inst_t *uart_instance, uint8_t gpio_index, bool device_state, uint32_t flash_client_index)</td></tr>
<tr class="memdesc:a050f4f15325b256ffb95a79c912dcb09"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sets the state of a single device and updates flash accordingly.  <br /></td></tr>
<tr class="memitem:a22814c8a3091271ff0f644b78fbf5bd3" id="r_a22814c8a3091271ff0f644b78fbf5bd3"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a22814c8a3091271ff0f644b78fbf5bd3">save_running_configuration_into_preset_configuration</a> (uint32_t flash_configuration_index, uint32_t flash_client_index)</td></tr>
<tr class="memdesc:a22814c8a3091271ff0f644b78fbf5bd3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Saves the current running configuration of a client into a preset slot.  <br /></td></tr>
<tr class="memitem:a5d6522f51f2e82efecc7bc7554ade2d0" id="r_a5d6522f51f2e82efecc7bc7554ade2d0"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a5d6522f51f2e82efecc7bc7554ade2d0">load_configuration_into_running_state</a> (uint32_t flash_configuration_index, uint32_t flash_client_index)</td></tr>
<tr class="memdesc:a5d6522f51f2e82efecc7bc7554ade2d0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Loads a saved preset configuration into a client's running state.  <br /></td></tr>
<tr class="memitem:abab7af7564d7d10ad8fd3e632066408e" id="r_abab7af7564d7d10ad8fd3e632066408e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#abab7af7564d7d10ad8fd3e632066408e">set_configuration_devices</a> (uint32_t flash_client_index, uint32_t flash_configuration_index, <a class="el" href="structinput__client__data__t.html">input_client_data_t</a> *client_data)</td></tr>
<tr class="memdesc:abab7af7564d7d10ad8fd3e632066408e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Configures the devices for a given client and preset configuration index.  <br /></td></tr>
<tr class="memitem:a25bc83fc3a5ae9f2471e14000a7aabd1" id="r_a25bc83fc3a5ae9f2471e14000a7aabd1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a25bc83fc3a5ae9f2471e14000a7aabd1">reset_all_client_data</a> (uint32_t flash_client_index)</td></tr>
<tr class="memdesc:a25bc83fc3a5ae9f2471e14000a7aabd1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Resets all configuration data for a specified client.  <br /></td></tr>
<tr class="memitem:aa248b21af874055c05e39588ac3b50b4" id="r_aa248b21af874055c05e39588ac3b50b4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aa248b21af874055c05e39588ac3b50b4">reset_running_configuration</a> (uint32_t flash_client_index)</td></tr>
<tr class="memdesc:aa248b21af874055c05e39588ac3b50b4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Resets the running configuration of a specified client to its default state.  <br /></td></tr>
<tr class="memitem:a6ba1f5041dc967797351dc7bb856df3b" id="r_a6ba1f5041dc967797351dc7bb856df3b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a6ba1f5041dc967797351dc7bb856df3b">reset_preset_configuration</a> (uint32_t flash_client_index, uint32_t flash_configuration_index)</td></tr>
<tr class="memdesc:a6ba1f5041dc967797351dc7bb856df3b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Resets a specific preset configuration for a given client in flash.  <br /></td></tr>
<tr class="memitem:a3f6bebbfab4e97a7b23a5268f4d66869" id="r_a3f6bebbfab4e97a7b23a5268f4d66869"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a3f6bebbfab4e97a7b23a5268f4d66869">server_configure_persistent_state</a> (<a class="el" href="structserver__persistent__state__t.html">server_persistent_state_t</a> *server_persistent_state)</td></tr>
<tr class="memdesc:a3f6bebbfab4e97a7b23a5268f4d66869"><td class="mdescLeft">&#160;</td><td class="mdescRight">Fills the entire persistent state structure and saves it to flash.  <br /></td></tr>
<tr class="memitem:a94d7bf2a7f0be569d87b14fe3524395d" id="r_a94d7bf2a7f0be569d87b14fe3524395d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a94d7bf2a7f0be569d87b14fe3524395d">server_reset_configuration</a> (<a class="el" href="structclient__state__t.html">client_state_t</a> *client_state)</td></tr>
<tr class="memdesc:a94d7bf2a7f0be569d87b14fe3524395d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Resets the runtime GPIO configuration for a given client.  <br /></td></tr>
<tr class="memitem:a725e67537885c5d35871e1875db7506c" id="r_a725e67537885c5d35871e1875db7506c"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a725e67537885c5d35871e1875db7506c">load_server_state</a> (<a class="el" href="structserver__persistent__state__t.html">server_persistent_state_t</a> *out_state)</td></tr>
<tr class="memdesc:a725e67537885c5d35871e1875db7506c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Loads the server state from flash and validates it using CRC32.  <br /></td></tr>
<tr class="memitem:a8e07211acfc66931f993aef0c3c6c7fb" id="r_a8e07211acfc66931f993aef0c3c6c7fb"><td class="memItemLeft" align="right" valign="top">void __not_in_flash_func&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a8e07211acfc66931f993aef0c3c6c7fb">save_server_state</a> (const <a class="el" href="structserver__persistent__state__t.html">server_persistent_state_t</a> *state_in)</td></tr>
<tr class="memdesc:a8e07211acfc66931f993aef0c3c6c7fb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Saves the persistent server state structure to flash memory.  <br /></td></tr>
<tr class="memitem:a42c8df3599e5bf75f043b1d59e83e730" id="r_a42c8df3599e5bf75f043b1d59e83e730"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a42c8df3599e5bf75f043b1d59e83e730">get_active_client_connection_index_from_flash_client_index</a> (uint32_t flash_client_index, <a class="el" href="structserver__persistent__state__t.html">server_persistent_state_t</a> state)</td></tr>
<tr class="memdesc:a42c8df3599e5bf75f043b1d59e83e730"><td class="mdescLeft">&#160;</td><td class="mdescRight">Retrieves the index of an active client connection matching a flash-stored client.  <br /></td></tr>
<tr class="memitem:a86c2e540fb9fb9aa0d840f81679a5fdb" id="r_a86c2e540fb9fb9aa0d840f81679a5fdb"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a86c2e540fb9fb9aa0d840f81679a5fdb">server_load_running_states_to_active_clients</a> (void)</td></tr>
<tr class="memdesc:a86c2e540fb9fb9aa0d840f81679a5fdb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Loads saved GPIO states from flash and sends them to active clients.  <br /></td></tr>
<tr class="memitem:a3824f1d29b9101a5d32bc4938d10305c" id="r_a3824f1d29b9101a5d32bc4938d10305c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a3824f1d29b9101a5d32bc4938d10305c">server_print_state_devices</a> (const <a class="el" href="structclient__state__t.html">client_state_t</a> *client_state)</td></tr>
<tr class="memdesc:a3824f1d29b9101a5d32bc4938d10305c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Prints the state of all devices from a given client state structure.  <br /></td></tr>
<tr class="memitem:ab0091cab79fc6a26dec5a260c238e5b5" id="r_ab0091cab79fc6a26dec5a260c238e5b5"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ab0091cab79fc6a26dec5a260c238e5b5">server_print_running_client_state</a> (const <a class="el" href="structclient__t.html">client_t</a> *client)</td></tr>
<tr class="memdesc:ab0091cab79fc6a26dec5a260c238e5b5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Prints the current GPIO state for a given client.  <br /></td></tr>
<tr class="memitem:aec66c7eb323e49b6801199d373793161" id="r_aec66c7eb323e49b6801199d373793161"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aec66c7eb323e49b6801199d373793161">server_print_client_preset_configuration</a> (const <a class="el" href="structclient__t.html">client_t</a> *client, uint8_t client_preset_index)</td></tr>
<tr class="memdesc:aec66c7eb323e49b6801199d373793161"><td class="mdescLeft">&#160;</td><td class="mdescRight">Prints a saved preset configuration for a given client.  <br /></td></tr>
<tr class="memitem:af79794cc92a2bd9e49d0552ef190126c" id="r_af79794cc92a2bd9e49d0552ef190126c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#af79794cc92a2bd9e49d0552ef190126c">server_print_client_preset_configurations</a> (const <a class="el" href="structclient__t.html">client_t</a> *client)</td></tr>
<tr class="memdesc:af79794cc92a2bd9e49d0552ef190126c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Prints all preset configurations for a client.  <br /></td></tr>
<tr class="memitem:abf00606cee7fb1a66191388be08ac24b" id="r_abf00606cee7fb1a66191388be08ac24b"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#abf00606cee7fb1a66191388be08ac24b">client_has_active_devices</a> (<a class="el" href="structclient__t.html">client_t</a> client)</td></tr>
<tr class="memdesc:abf00606cee7fb1a66191388be08ac24b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Checks if a client has any active (ON) devices.  <br /></td></tr>
<tr class="memitem:a53e73d8096b04a30d2349aca5910e7e0" id="r_a53e73d8096b04a30d2349aca5910e7e0"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a53e73d8096b04a30d2349aca5910e7e0">find_corect_client_index_from_flash</a> (uint32_t *flash_client_index, uint32_t client_index, const <a class="el" href="structserver__persistent__state__t.html">server_persistent_state_t</a> *flash_state)</td></tr>
<tr class="memdesc:a53e73d8096b04a30d2349aca5910e7e0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Finds the corresponding flash client index for a given active client.  <br /></td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-var-members" class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:af0fed1de099fc59d4959ea2425d4a1f9" id="r_af0fed1de099fc59d4959ea2425d4a1f9"><td class="memItemLeft" align="right" valign="top">spin_lock_t *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#af0fed1de099fc59d4959ea2425d4a1f9">uart_lock</a></td></tr>
<tr class="memitem:ae4762df2fab238c5e19ac8fc390dd0f6" id="r_ae4762df2fab238c5e19ac8fc390dd0f6"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structserver__uart__connection__t.html">server_uart_connection_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ae4762df2fab238c5e19ac8fc390dd0f6">active_uart_server_connections</a> [<a class="el" href="config_8h.html#a2af0f36093c4b4dfb77395b7216135e1">MAX_SERVER_CONNECTIONS</a>]</td></tr>
<tr class="memdesc:ae4762df2fab238c5e19ac8fc390dd0f6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Active UART server connections detected at runtime.  <br /></td></tr>
<tr class="memitem:aa1ef43f549692dec740d6140a38acbd1" id="r_aa1ef43f549692dec740d6140a38acbd1"><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aa1ef43f549692dec740d6140a38acbd1">active_server_connections_number</a></td></tr>
<tr class="memdesc:aa1ef43f549692dec740d6140a38acbd1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Number of active connections found and stored in <span class="tt">active_uart_server_connections</span>.  <br /></td></tr>
</table>
<a name="details" id="details"></a><h2 id="header-details" class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Central interface for server-side UART client management and GPIO state handling. </p>
<p>This header declares all server-side functions and variables used for:</p><ul>
<li>Discovering UART-connected clients</li>
<li>Managing persistent state (running and preset configurations)</li>
<li>Communicating with clients via UART</li>
<li>Flash memory operations (load/save with CRC)</li>
<li>Resetting, loading, and printing client GPIO configurations</li>
<li>Handling dormant/active state transitions</li>
</ul>
<p>It serves as the main coordination point between UART communication, persistent memory, and user interface logic via the USB CLI.</p>
<p>All modules (config, flash, menu, CLI, and communication) include and rely on this header. </p>
</div><a name="doc-define-members" id="doc-define-members"></a><h2 id="header-doc-define-members" class="groupheader">Macro Definition Documentation</h2>
<a id="ae0cb76c73e0b10cd0a339a3d50189a6c" name="ae0cb76c73e0b10cd0a339a3d50189a6c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae0cb76c73e0b10cd0a339a3d50189a6c">&#9670;&#160;</a></span>UART_SPINLOCK_ID</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define UART_SPINLOCK_ID&#160;&#160;&#160;0</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a name="doc-func-members" id="doc-func-members"></a><h2 id="header-doc-func-members" class="groupheader">Function Documentation</h2>
<a id="abf00606cee7fb1a66191388be08ac24b" name="abf00606cee7fb1a66191388be08ac24b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abf00606cee7fb1a66191388be08ac24b">&#9670;&#160;</a></span>client_has_active_devices()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool client_has_active_devices </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structclient__t.html">client_t</a></td>          <td class="paramname"><span class="paramname"><em>client</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Checks if a client has any active (ON) devices. </p>
<p>Iterates through the client's GPIO-controlled devices and returns true if at least one is currently turned ON.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">client</td><td>The client structure to inspect. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true if any device is ON; false otherwise. </dd></dl>

</div>
</div>
<a id="a53e73d8096b04a30d2349aca5910e7e0" name="a53e73d8096b04a30d2349aca5910e7e0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a53e73d8096b04a30d2349aca5910e7e0">&#9670;&#160;</a></span>find_corect_client_index_from_flash()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void find_corect_client_index_from_flash </td>
          <td>(</td>
          <td class="paramtype">uint32_t *</td>          <td class="paramname"><span class="paramname"><em>flash_client_index</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t</td>          <td class="paramname"><span class="paramname"><em>client_index</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structserver__persistent__state__t.html">server_persistent_state_t</a> *</td>          <td class="paramname"><span class="paramname"><em>flash_state</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel inline">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Finds the corresponding flash client index for a given active client. </p>
<p>Compares the TX pin of the selected client with entries in the flash structure to determine the matching flash client index.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">flash_client_index</td><td>Output pointer to store the resolved flash index. </td></tr>
    <tr><td class="paramname">client_index</td><td>Index of the selected client (1-based). </td></tr>
    <tr><td class="paramname">flash_state</td><td>Pointer to the flash-stored server state. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a42c8df3599e5bf75f043b1d59e83e730" name="a42c8df3599e5bf75f043b1d59e83e730"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a42c8df3599e5bf75f043b1d59e83e730">&#9670;&#160;</a></span>get_active_client_connection_index_from_flash_client_index()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t get_active_client_connection_index_from_flash_client_index </td>
          <td>(</td>
          <td class="paramtype">uint32_t</td>          <td class="paramname"><span class="paramname"><em>flash_client_index</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structserver__persistent__state__t.html">server_persistent_state_t</a></td>          <td class="paramname"><span class="paramname"><em>state</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Retrieves the index of an active client connection matching a flash-stored client. </p>
<p>Iterates through active UART server connections and compares their TX pins with the TX pin of the client at the specified index in the persistent flash state.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">flash_client_index</td><td>Index of the client in the persistent flash state array. </td></tr>
    <tr><td class="paramname">state</td><td>The loaded persistent server state. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Index of the matching active connection, or INVALID_CLIENT_INDEX if not found. </dd></dl>

</div>
</div>
<a id="a5d6522f51f2e82efecc7bc7554ade2d0" name="a5d6522f51f2e82efecc7bc7554ade2d0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5d6522f51f2e82efecc7bc7554ade2d0">&#9670;&#160;</a></span>load_configuration_into_running_state()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void load_configuration_into_running_state </td>
          <td>(</td>
          <td class="paramtype">uint32_t</td>          <td class="paramname"><span class="paramname"><em>flash_configuration_index</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t</td>          <td class="paramname"><span class="paramname"><em>flash_client_index</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Loads a saved preset configuration into a client's running state. </p>
<p>Copies the selected preset configuration into the client's current state, sends the new state to the client via UART, and updates the persistent flash. If the loaded configuration results in all devices being OFF, the client is marked as dormant.</p>
<p>A confirmation message is printed to the USB CLI.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">flash_configuration_index</td><td>Index of the preset configuration to load. </td></tr>
    <tr><td class="paramname">flash_client_index</td><td>Index of the target client in the persistent flash state. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a725e67537885c5d35871e1875db7506c" name="a725e67537885c5d35871e1875db7506c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a725e67537885c5d35871e1875db7506c">&#9670;&#160;</a></span>load_server_state()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool load_server_state </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structserver__persistent__state__t.html">server_persistent_state_t</a> *</td>          <td class="paramname"><span class="paramname"><em>out_state</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Loads the server state from flash and validates it using CRC32. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">out_state</td><td>Pointer to destination structure to store loaded state. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true if CRC is valid and data is intact, false otherwise. </dd></dl>

</div>
</div>
<a id="a5dc7da044bb632212f8b68cfaf3f598c" name="a5dc7da044bb632212f8b68cfaf3f598c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5dc7da044bb632212f8b68cfaf3f598c">&#9670;&#160;</a></span>periodic_wakeup()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void periodic_wakeup </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Core1 wakeup handler triggered by inter-core messages. </p>
<p>Handles two commands:</p><ul>
<li><span class="tt">DUMP_BUFFER_WAKEUP_MESSAGE</span>: Reprints stored output to CLI.</li>
<li><span class="tt">BLINK_LED_WAKEUP_MESSAGE</span>: Triggers fast onboard LED blink and mirrors to clients. </li>
</ul>

</div>
</div>
<a id="a25bc83fc3a5ae9f2471e14000a7aabd1" name="a25bc83fc3a5ae9f2471e14000a7aabd1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a25bc83fc3a5ae9f2471e14000a7aabd1">&#9670;&#160;</a></span>reset_all_client_data()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void reset_all_client_data </td>
          <td>(</td>
          <td class="paramtype">uint32_t</td>          <td class="paramname"><span class="paramname"><em>flash_client_index</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Resets all configuration data for a specified client. </p>
<p>This includes:</p><ul>
<li>Resetting the client's current (running) configuration</li>
<li>Sending the reset state to the client via UART</li>
<li>Marking the client as dormant</li>
<li>Resetting all preset configurations associated with the client</li>
<li>Saving the updated state to flash</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">flash_client_index</td><td>Index of the client in the persistent flash state array. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a6ba1f5041dc967797351dc7bb856df3b" name="a6ba1f5041dc967797351dc7bb856df3b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6ba1f5041dc967797351dc7bb856df3b">&#9670;&#160;</a></span>reset_preset_configuration()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void reset_preset_configuration </td>
          <td>(</td>
          <td class="paramtype">uint32_t</td>          <td class="paramname"><span class="paramname"><em>flash_client_index</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t</td>          <td class="paramname"><span class="paramname"><em>flash_configuration_index</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Resets a specific preset configuration for a given client in flash. </p>
<p>This function loads the current persistent server state from flash, resets the specified preset configuration for the given client (excluding UART flags), and then saves the updated state back to flash memory.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">flash_client_index</td><td>Index of the client in the flash-stored client list. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">flash_configuration_index</td><td>Index of the preset configuration to reset (1-based). </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="aa248b21af874055c05e39588ac3b50b4" name="aa248b21af874055c05e39588ac3b50b4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa248b21af874055c05e39588ac3b50b4">&#9670;&#160;</a></span>reset_running_configuration()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void reset_running_configuration </td>
          <td>(</td>
          <td class="paramtype">uint32_t</td>          <td class="paramname"><span class="paramname"><em>flash_client_index</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Resets the running configuration of a specified client to its default state. </p>
<p>Loads the server's persistent state, resets the client's current configuration, sends the updated state to the client, marks the client as dormant, and saves the updated state back to flash.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">flash_client_index</td><td>Index of the client in the persistent flash state array. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a22814c8a3091271ff0f644b78fbf5bd3" name="a22814c8a3091271ff0f644b78fbf5bd3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a22814c8a3091271ff0f644b78fbf5bd3">&#9670;&#160;</a></span>save_running_configuration_into_preset_configuration()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void save_running_configuration_into_preset_configuration </td>
          <td>(</td>
          <td class="paramtype">uint32_t</td>          <td class="paramname"><span class="paramname"><em>flash_configuration_index</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t</td>          <td class="paramname"><span class="paramname"><em>flash_client_index</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Saves the current running configuration of a client into a preset slot. </p>
<p>Loads the full persistent server state from flash, copies the active running state of the specified client into the selected preset configuration slot, and saves the updated structure back to flash.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">flash_configuration_index</td><td>Index of the target preset configuration [0..(NUMBER_OF_POSSIBLE_PRESETS - 1)]. </td></tr>
    <tr><td class="paramname">flash_client_index</td><td>Index of the client within the persistent flash state. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a8e07211acfc66931f993aef0c3c6c7fb" name="a8e07211acfc66931f993aef0c3c6c7fb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8e07211acfc66931f993aef0c3c6c7fb">&#9670;&#160;</a></span>save_server_state()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void __not_in_flash_func save_server_state </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structserver__persistent__state__t.html">server_persistent_state_t</a> *</td>          <td class="paramname"><span class="paramname"><em>state_in</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Saves the persistent server state structure to flash memory. </p>
<ul>
<li>Computes CRC</li>
<li>Erases and programs the flash sector</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">state_in</td><td>Pointer to the <a class="el" href="structserver__persistent__state__t.html" title="Full persistent state saved in flash.">server_persistent_state_t</a> structure to save. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="abf6b2d1e49b4c895c9672070cb2d1c98" name="abf6b2d1e49b4c895c9672070cb2d1c98"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abf6b2d1e49b4c895c9672070cb2d1c98">&#9670;&#160;</a></span>send_dormant_flag_to_client()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void send_dormant_flag_to_client </td>
          <td>(</td>
          <td class="paramtype">uint8_t</td>          <td class="paramname"><span class="paramname"><em>client_index</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Sends a dormant flag message to a specific client over UART. </p>
<p>Constructs a message with the dormant flag number and sends it via the UART instance and pin pair assigned to the specified client.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">client_index</td><td>Index of the client in the active server connections. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ac3717ffc0c3e393f14d1114bb67a0a5e" name="ac3717ffc0c3e393f14d1114bb67a0a5e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac3717ffc0c3e393f14d1114bb67a0a5e">&#9670;&#160;</a></span>send_dormant_to_standby_clients()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void send_dormant_to_standby_clients </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Sends a dormant message to all clients marked as dormant. </p>
<p>Iterates through all active UART connections and sends a predefined dormant flag message to each client with the <span class="tt">is_dormant</span> flag set. </p>

</div>
</div>
<a id="a32876b443b0945b7f0a82cd1cb8dae68" name="a32876b443b0945b7f0a82cd1cb8dae68"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a32876b443b0945b7f0a82cd1cb8dae68">&#9670;&#160;</a></span>send_fast_blink_onboard_led_to_clients()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void send_fast_blink_onboard_led_to_clients </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Sends a fast onboard LED blink signal to all clients. </p>
<p>Triggers a visual blink (e.g., heartbeat) on each client device. </p>

</div>
</div>
<a id="ab855eab340123db70c04fa5c11b7a030" name="ab855eab340123db70c04fa5c11b7a030"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab855eab340123db70c04fa5c11b7a030">&#9670;&#160;</a></span>send_uart_message_safe()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void send_uart_message_safe </td>
          <td>(</td>
          <td class="paramtype">uart_inst_t *</td>          <td class="paramname"><span class="paramname"><em>uart</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structuart__pin__pair__t.html">uart_pin_pair_t</a></td>          <td class="paramname"><span class="paramname"><em>pins</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>msg</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Sends a UART message safely using spinlock protection. </p>
<p>This function first wakes up the client by sending a pulse on its RX pin. Then it initializes the UART peripheral with the specified TX/RX pins and baudrate, sends the message, waits for the transmission to complete, and resets the GPIO pins. All UART operations are protected by a spinlock to ensure thread/core safety.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">uart</td><td>Pointer to the UART instance to use (e.g., uart0 or uart1). </td></tr>
    <tr><td class="paramname">pins</td><td>Struct containing the TX and RX GPIO pin numbers. </td></tr>
    <tr><td class="paramname">msg</td><td>Null-terminated string to be sent via UART. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ad2a8b81914e338148d4ca14af0dda019" name="ad2a8b81914e338148d4ca14af0dda019"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad2a8b81914e338148d4ca14af0dda019">&#9670;&#160;</a></span>send_wakeup_if_dormant()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void send_wakeup_if_dormant </td>
          <td>(</td>
          <td class="paramtype">uint32_t</td>          <td class="paramname"><span class="paramname"><em>flash_client_index</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structserver__persistent__state__t.html">server_persistent_state_t</a> *const</td>          <td class="paramname"><span class="paramname"><em>state</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structuart__pin__pair__t.html">uart_pin_pair_t</a></td>          <td class="paramname"><span class="paramname"><em>pin_pair</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uart_inst_t *const</td>          <td class="paramname"><span class="paramname"><em>uart</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Wakes up a dormant client if needed, based on its persistent state. </p>
<p>Checks whether the client at the specified index is dormant. If so, it sends a wake-up pulse via UART to ensure the client is active before communication.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">flash_client_index</td><td>Index of the client in the persistent state table. </td></tr>
    <tr><td class="paramname">state</td><td>Pointer to the global persistent state structure. </td></tr>
    <tr><td class="paramname">pin_pair</td><td>UART TX/RX pins used to wake up the client. </td></tr>
    <tr><td class="paramname">uart</td><td>Pointer to the UART instance used for transmission.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="client__communication_8c.html#a875e8f94cd85ca554775cb706740ddf4" title="Wakes up a client device by toggling RX pin and sending a wake-up message.">wake_up_client()</a> </dd></dl>

</div>
</div>
<a id="a3f6bebbfab4e97a7b23a5268f4d66869" name="a3f6bebbfab4e97a7b23a5268f4d66869"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3f6bebbfab4e97a7b23a5268f4d66869">&#9670;&#160;</a></span>server_configure_persistent_state()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void server_configure_persistent_state </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structserver__persistent__state__t.html">server_persistent_state_t</a> *</td>          <td class="paramname"><span class="paramname"><em>server_persistent_state</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Fills the entire persistent state structure and saves it to flash. </p>
<ul>
<li>Called when flash is empty or invalid.</li>
<li>Configures all known clients.</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">server_persistent_state</td><td>Pointer to state struct to fill and write. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="abef816bc7a87ae61e1da71a2d0c5da91" name="abef816bc7a87ae61e1da71a2d0c5da91"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abef816bc7a87ae61e1da71a2d0c5da91">&#9670;&#160;</a></span>server_find_connections()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool server_find_connections </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Scans all possible UART pin pairs to detect connected clients. </p>
<p>Performs UART handshakes and fills <span class="tt">active_uart_server_connections</span> with valid connections.</p>
<dl class="section return"><dt>Returns</dt><dd>true if at least one client is found and validated, false otherwise.</dd></dl>
<p>Scans all possible UART pin pairs to detect connected clients.</p>
<p>Calls the UART0 and UART1 connection checkers to identify all valid connections. </p>

</div>
</div>
<a id="a86c2e540fb9fb9aa0d840f81679a5fdb" name="a86c2e540fb9fb9aa0d840f81679a5fdb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a86c2e540fb9fb9aa0d840f81679a5fdb">&#9670;&#160;</a></span>server_load_running_states_to_active_clients()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void server_load_running_states_to_active_clients </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Loads saved GPIO states from flash and sends them to active clients. </p>
<ul>
<li>Verifies CRC of saved state in flash.</li>
<li>Sends current (running) state to each active client over UART.</li>
<li>If CRC is invalid, calls <span class="tt"><a class="el" href="#a3f6bebbfab4e97a7b23a5268f4d66869" title="Fills the entire persistent state structure and saves it to flash.">server_configure_persistent_state()</a></span> to reset flash. </li>
</ul>

</div>
</div>
<a id="aec66c7eb323e49b6801199d373793161" name="aec66c7eb323e49b6801199d373793161"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aec66c7eb323e49b6801199d373793161">&#9670;&#160;</a></span>server_print_client_preset_configuration()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void server_print_client_preset_configuration </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structclient__t.html">client_t</a> *</td>          <td class="paramname"><span class="paramname"><em>client</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t</td>          <td class="paramname"><span class="paramname"><em>client_preset_index</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Prints a saved preset configuration for a given client. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">client</td><td>Pointer to the <a class="el" href="structclient__t.html" title="Represents a complete client entry in the system.">client_t</a>. </td></tr>
    <tr><td class="paramname">client_preset_index</td><td>Preset index to print (0 to NUMBER_OF_POSSIBLE_PRESETS - 1). </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="af79794cc92a2bd9e49d0552ef190126c" name="af79794cc92a2bd9e49d0552ef190126c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af79794cc92a2bd9e49d0552ef190126c">&#9670;&#160;</a></span>server_print_client_preset_configurations()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void server_print_client_preset_configurations </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structclient__t.html">client_t</a> *</td>          <td class="paramname"><span class="paramname"><em>client</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Prints all preset configurations for a client. </p>
<ul>
<li>Iterates through each preset slot of the client.</li>
<li>Prints each configuration using <span class="tt"><a class="el" href="#aec66c7eb323e49b6801199d373793161" title="Prints a saved preset configuration for a given client.">server_print_client_preset_configuration()</a></span>.</li>
<li>Adds spacing between configurations for clarity.</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">client</td><td>Pointer to the <a class="el" href="structclient__t.html" title="Represents a complete client entry in the system.">client_t</a> structure containing the preset configurations. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ab0091cab79fc6a26dec5a260c238e5b5" name="ab0091cab79fc6a26dec5a260c238e5b5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab0091cab79fc6a26dec5a260c238e5b5">&#9670;&#160;</a></span>server_print_running_client_state()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void server_print_running_client_state </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structclient__t.html">client_t</a> *</td>          <td class="paramname"><span class="paramname"><em>client</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Prints the current GPIO state for a given client. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">client</td><td>Pointer to the <a class="el" href="structclient__t.html" title="Represents a complete client entry in the system.">client_t</a> structure to print. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a3824f1d29b9101a5d32bc4938d10305c" name="a3824f1d29b9101a5d32bc4938d10305c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3824f1d29b9101a5d32bc4938d10305c">&#9670;&#160;</a></span>server_print_state_devices()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void server_print_state_devices </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structclient__state__t.html">client_state_t</a> *</td>          <td class="paramname"><span class="paramname"><em>client_state</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Prints the state of all devices from a given client state structure. </p>
<ul>
<li>Iterates through all available GPIO devices.</li>
<li>Prints each device's state using <span class="tt"><a class="el" href="state__print_8c.html#a6c6caaec70b354926f1fb8e1d1d33035" title="Prints the GPIO state of a device at the given index in a client.">server_print_gpio_state()</a></span>.</li>
<li>Skips devices used for UART communication.</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">client_state</td><td>Pointer to the <a class="el" href="structclient__state__t.html" title="Represents the current or saved state of a client&#39;s GPIO devices.">client_state_t</a> structure to display. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a94d7bf2a7f0be569d87b14fe3524395d" name="a94d7bf2a7f0be569d87b14fe3524395d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a94d7bf2a7f0be569d87b14fe3524395d">&#9670;&#160;</a></span>server_reset_configuration()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void server_reset_configuration </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structclient__state__t.html">client_state_t</a> *</td>          <td class="paramname"><span class="paramname"><em>client_state</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Resets the runtime GPIO configuration for a given client. </p>
<p>This function iterates through all devices associated with the client and sets their <span class="tt">is_on</span> flag to false, effectively turning them off. Devices marked with the special UART connection flag are excluded from this reset.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">client_state</td><td>Pointer to the client's current runtime state to be modified. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a85446e6a4007b664f2fb03cfa588e092" name="a85446e6a4007b664f2fb03cfa588e092"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a85446e6a4007b664f2fb03cfa588e092">&#9670;&#160;</a></span>server_send_client_state()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void server_send_client_state </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structuart__pin__pair__t.html">uart_pin_pair_t</a></td>          <td class="paramname"><span class="paramname"><em>pin_pair</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uart_inst_t *</td>          <td class="paramname"><span class="paramname"><em>uart</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structclient__state__t.html">client_state_t</a> *</td>          <td class="paramname"><span class="paramname"><em>state</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Sends the entire current client state over UART. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pin_pair</td><td>UART TX/RX pin pair to use. </td></tr>
    <tr><td class="paramname">uart</td><td>UART instance. </td></tr>
    <tr><td class="paramname">state</td><td>Pointer to the <a class="el" href="structclient__state__t.html" title="Represents the current or saved state of a client&#39;s GPIO devices.">client_state_t</a> to send. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a050f4f15325b256ffb95a79c912dcb09" name="a050f4f15325b256ffb95a79c912dcb09"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a050f4f15325b256ffb95a79c912dcb09">&#9670;&#160;</a></span>server_set_device_state_and_update_flash()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void server_set_device_state_and_update_flash </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structuart__pin__pair__t.html">uart_pin_pair_t</a></td>          <td class="paramname"><span class="paramname"><em>pin_pair</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uart_inst_t *</td>          <td class="paramname"><span class="paramname"><em>uart_instance</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t</td>          <td class="paramname"><span class="paramname"><em>gpio_index</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool</td>          <td class="paramname"><span class="paramname"><em>device_state</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t</td>          <td class="paramname"><span class="paramname"><em>flash_client_index</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Sets the state of a single device and updates flash accordingly. </p>
<ul>
<li>Sends the updated GPIO state to the client via UART.</li>
<li>Loads a copy of the persistent state from flash.</li>
<li>Updates the state in RAM and saves the structure back to flash.</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pin_pair</td><td>TX/RX pins for the UART connection to the client. </td></tr>
    <tr><td class="paramname">uart_instance</td><td>UART peripheral used. </td></tr>
    <tr><td class="paramname">gpio_index</td><td>GPIO number to modify on the client. </td></tr>
    <tr><td class="paramname">device_state</td><td>true = ON, false = OFF. </td></tr>
    <tr><td class="paramname">flash_client_index</td><td>Index of the client in flash storage. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="abab7af7564d7d10ad8fd3e632066408e" name="abab7af7564d7d10ad8fd3e632066408e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abab7af7564d7d10ad8fd3e632066408e">&#9670;&#160;</a></span>set_configuration_devices()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void set_configuration_devices </td>
          <td>(</td>
          <td class="paramtype">uint32_t</td>          <td class="paramname"><span class="paramname"><em>flash_client_index</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t</td>          <td class="paramname"><span class="paramname"><em>flash_configuration_index</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structinput__client__data__t.html">input_client_data_t</a> *</td>          <td class="paramname"><span class="paramname"><em>client_data</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Configures the devices for a given client and preset configuration index. </p>
<p>This function enters an interactive loop where the user can set the ON/OFF state for specific devices (GPIOs) of a selected client. The changes are stored in the specified preset configuration index within the server's persistent state.</p>
<p>The loop continues to prompt the user for device index and state until the input routine signals an exit (typically via a cancel command or invalid input).</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">flash_client_index</td><td>Index of the client in flash memory (persistent state). </td></tr>
    <tr><td class="paramname">flash_configuration_index</td><td>Index of the preset configuration to modify. </td></tr>
    <tr><td class="paramname">client_data</td><td>Pointer to a structure used for passing user input data. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a5373fcd0050ee1a3cccb2d3f7096b489" name="a5373fcd0050ee1a3cccb2d3f7096b489"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5373fcd0050ee1a3cccb2d3f7096b489">&#9670;&#160;</a></span>signal_reset_for_all_clients()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void signal_reset_for_all_clients </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Sends a reset trigger message to all clients. </p>
<p>This causes each connected client to perform a full reset of its internal state. </p>

</div>
</div>
<a name="doc-var-members" id="doc-var-members"></a><h2 id="header-doc-var-members" class="groupheader">Variable Documentation</h2>
<a id="aa1ef43f549692dec740d6140a38acbd1" name="aa1ef43f549692dec740d6140a38acbd1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa1ef43f549692dec740d6140a38acbd1">&#9670;&#160;</a></span>active_server_connections_number</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t active_server_connections_number</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel extern">extern</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Number of active connections found and stored in <span class="tt">active_uart_server_connections</span>. </p>

</div>
</div>
<a id="ae4762df2fab238c5e19ac8fc390dd0f6" name="ae4762df2fab238c5e19ac8fc390dd0f6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae4762df2fab238c5e19ac8fc390dd0f6">&#9670;&#160;</a></span>active_uart_server_connections</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structserver__uart__connection__t.html">server_uart_connection_t</a> active_uart_server_connections[<a class="el" href="config_8h.html#a2af0f36093c4b4dfb77395b7216135e1">MAX_SERVER_CONNECTIONS</a>]</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel extern">extern</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Active UART server connections detected at runtime. </p>
<p>Filled after a successful scan in <span class="tt"><a class="el" href="#abef816bc7a87ae61e1da71a2d0c5da91" title="Scans all possible UART pin pairs to detect connected clients.">server_find_connections()</a></span>. </p>

</div>
</div>
<a id="af0fed1de099fc59d4959ea2425d4a1f9" name="af0fed1de099fc59d4959ea2425d4a1f9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af0fed1de099fc59d4959ea2425d4a1f9">&#9670;&#160;</a></span>uart_lock</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">spin_lock_t* uart_lock</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel extern">extern</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a href="dir_d44c64559bbebec7f509842c48db8b23.html">include</a></li><li class="navelem"><a href="server_8h.html">server.h</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.14.0 </li>
  </ul>
</div>
</body>
</html>
